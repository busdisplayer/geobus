<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Geobus - Beauregard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="L'application nouvelle génération de suivi des bus en temps réel !">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="shortcut icon" href="https://tse1.mm.bing.net/th?id=OIP.yaHzz-GnzQqctUkIr3V-QgHaHa&pid=Api">
</head>
<body class="w3-light-grey">

    <header class="w3-container w3-blue w3-center w3-padding-16">
        <h1>Géobus - Beauregard</h1>
    </header>

    <section class="w3-container w3-padding">
        <table id="tableProchainsDeparts" class="w3-table w3-bordered w3-striped w3-white">
            <thead>
                <tr class="w3-blue">
                    <th>Ligne</th>
                    <th>Destination</th>
                    <th>Prochain Départ</th>
                </tr>
            </thead>
            <tbody>
                <!-- Les données seront insérées ici -->
            </tbody>
        </table>
    </section>

    <script>
        // Définition des lignes de bus, des destinations et des horaires
        const lignesBus = [
            { ligne: "Ligne 1", destination: "Centre-ville", horaires: ["08:00", "09:30", "10:15"] },
            { ligne: "Ligne 2", destination: "Gare", horaires: ["07:45", "09:00", "11:00"] },
            { ligne: "Ligne 3", destination: "Université", horaires: ["08:10", "09:50", "10:50"] },
        ];

        // Fonction pour trouver le temps restant pour le prochain départ
        function prochainDepartMinutes(horaires) {
            const now = new Date();
            const currentMinutes = now.getHours() * 60 + now.getMinutes();
            let prochainDepart = Infinity;

            for (let heure of horaires) {
                const [h, m] = heure.split(":").map(Number);
                const minutes = h * 60 + m;
                if (minutes >= currentMinutes && minutes < prochainDepart) {
                    prochainDepart = minutes;
                }
            }
            return prochainDepart === Infinity ? -1 : prochainDepart - currentMinutes; // Retourne -1 si aucun départ
        }

        // Fonction pour calculer et afficher le temps restant
        function calculTempsRestant(minutesRestants) {
            if (minutesRestants < 0) {
                return "Aucun départ";
            } else if (minutesRestants === 0) {
                return "En station";
            } else if (minutesRestants === 1) {
                return "Imminent";
            } else {
                return `${minutesRestants} min`;
            }
        }

        // Fonction pour mettre à jour le tableau des départs
        function afficherProchainsDeparts() {
            const tableBody = document.querySelector("#tableProchainsDeparts tbody");
            tableBody.innerHTML = ''; // Réinitialise le contenu du tableau

            let hasDepartures = false; // Indicateur pour vérifier s'il y a des départs

            for (let bus of lignesBus) {
                const minutesRestants = prochainDepartMinutes(bus.horaires);
                if (minutesRestants >= 0) { // Ajoute uniquement les bus avec des départs à venir
                    hasDepartures = true;
                    const row = document.createElement("tr");

                    const ligneCell = document.createElement("td");
                    ligneCell.textContent = bus.ligne;
                    row.appendChild(ligneCell);

                    const destinationCell = document.createElement("td");
                    destinationCell.textContent = bus.destination;
                    row.appendChild(destinationCell);

                    const prochainDepartCell = document.createElement("td");
                    prochainDepartCell.textContent = calculTempsRestant(minutesRestants);
                    row.appendChild(prochainDepartCell);

                    tableBody.appendChild(row);
                }
            }

            // Si aucun départ n'est trouvé, afficher un message
            if (!hasDepartures) {
                const row = document.createElement("tr");
                const cell = document.createElement("td");
                cell.colSpan = 3;
                cell.textContent = "Aucun départ";
                cell.className = "w3-center"; // Centrer le message
                row.appendChild(cell);
                tableBody.appendChild(row);
            }
        }

        // Mettre à jour et afficher les prochains départs toutes les minutes
        afficherProchainsDeparts();
        setInterval(afficherProchainsDeparts, 60000);
    </script>
</body>
</html>
